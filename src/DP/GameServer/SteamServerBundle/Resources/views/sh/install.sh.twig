#!/bin/bash

CSP_FILE='cspromod_b108.zip'
CSP_DLURL="http://dl.redline-hosting.net/public/$CSP_FILE"

if [ $# -eq 1 ]; then
    # S'il s'agit de cspromod, on installe css
    # sur lequel on ajoute le mod via une archive
    if [ "$1" = "cspromod" ]; then
        JEU="Counter-Strike Source"
    else
        JEU="$1"
    fi

    # On commence par télécharger le hldsupdatetool.bin
    wget http://storefront.steampowered.com/download/hldsupdatetool.bin

    # On lui donne les droits et on l'exécute afin de récupérer l'updater steam
    chmod 750 hldsupdatetool.bin && ./hldsupdatetool.bin <<< "yes"

    # Il ne sert plus, on le supprime
    rm -f hldsupdatetool.bin

    # Puis on lance l'exécution de steam afin de mettre à jour l'exécutable
    ./steam
    sleep 1
    ./steam
    sleep 1

    # Et on lance l'install du jeu
    ./steam -command update -game "$JEU" -dir . -verify_all -retry

    # Si on souhaite installer cspromod, on telecharge l'archive du mod et on la decompresse
    if [ "$1" = "cspromod" ]; then
        mkdir orangebox && mv hl2 orangebox/
        ./steam -command update -game "orangebox" -dir . -verify_all -retry
        cd orangebox
        wget "$CSP_DLURL"
        unzip -u "$CSP_FILE"
        rm -f $CSP_FILE
    fi
else
	echo "Usage: $0 game"
fi