# Copyright (C) 2010-2013 Kerouanton Albin, Smedts Jérôme
#
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 2 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License along
# with this program; if not, write to the Free Software Foundation, Inc.,
# 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.

parameters:
    dedipanel.key_store.file.path: '%kernel.root_dir%/../app/config/.ssh/%kernel.environment%'
    dedipanel.connection_manager.debug: true

services:
    dedipanel.form.machine:
        class: DP\Core\MachineBundle\Form\MachineType
        tags:
            - { name: form.type, alias: dedipanel_machine }

    dedipanel.machine.subscriber.crud:
        class: DP\Core\MachineBundle\EventListener\CRUDListener
        arguments: [ @dedipanel.key_helper, @dedipanel.connection_manager ]
        tags:
            - { name: kernel.event_subscriber }

    dedipanel.security.voter.machine_assignable_voter:
        class: DP\Core\MachineBundle\Voter\MachineRelatedVoter
        arguments: [ @dedipanel.repository.group ]
        public: false
        tags:
            - { name: security.voter, priority: -255 }

    dedipanel.machine.listener.model:
        class: DP\Core\MachineBundle\EventListener\ModelListener
        arguments: [ @service_container ]
        tags:
            - { name: doctrine.event_listener, event: postLoad, method: postLoad }

    dedipanel.machine.validator.credentials:
        class: DP\Core\MachineBundle\Validator\CredentialsConstraintValidator
        arguments: [ @dedipanel.connection_manager ]
        tags:
            - { name: validator.constraint_validator, alias: "machine_credentials_validator" }

    dedipanel.machine.form.mapping:
        class: DP\Core\MachineBundle\Form\MachineEntityType
        arguments: [ @dedipanel.repository.machine, @dedipanel.resolver.user_group, @security.context ]
        tags:
            - { name: form.type, alias: dedipanel_machine_entity }
